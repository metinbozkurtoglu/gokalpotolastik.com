---
interface Props {
  title?: string;
  items: { question: string; answer: string }[];
}

const { title = "Sıkça Sorulan Sorular", items } = Astro.props;
---

<section class="bg-gray-50 py-16 lg:py-24">
  <div class="container-custom">
    <div class="flex flex-col lg:flex-row gap-12 lg:gap-20">

      {/* ── Sol: Başlık (desktop'ta sticky) ── */}
      <div class="lg:w-[340px] xl:w-[400px] flex-shrink-0 reveal">
        <div class="lg:sticky lg:top-32">
          <span class="inline-block w-12 h-1 bg-primary rounded-full mb-4"></span>
          <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 leading-tight mb-4">
            {title}
          </h2>
          <p class="text-gray-500 text-sm leading-relaxed">
            Merak ettiğiniz konularda hızlı yanıtlar. Burada bulamadıysanız bizi arayın.
          </p>
        </div>
      </div>

      {/* ── Sağ: Accordion ── */}
      <div class="flex-1 space-y-3" id="faq-accordion">
        {items.map((item, index) => (
          <div class={`faq-item glass-card overflow-hidden reveal reveal-delay-${Math.min(index + 1, 4)}`} data-index={index}>
            <button
              class="w-full flex items-center justify-between gap-4 p-5 lg:p-6 text-left cursor-pointer"
              aria-expanded="false"
              aria-controls={`faq-answer-${index}`}
            >
              <span class="text-gray-900 font-semibold text-base lg:text-lg pr-4">
                {item.question}
              </span>
              <div class="flex-shrink-0 w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center transition-all duration-300 faq-icon">
                <svg class="w-4 h-4 text-primary transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
              </div>
            </button>
            <div
              id={`faq-answer-${index}`}
              class="faq-answer overflow-hidden transition-all duration-300"
              style="max-height: 0;"
            >
              <div class="px-5 pb-5 lg:px-6 lg:pb-6 pt-0">
                <div class="w-full h-px bg-gray-200 mb-4"></div>
                <p class="text-gray-600 leading-relaxed text-[15px]">
                  {item.answer}
                </p>
              </div>
            </div>
          </div>
        ))}
      </div>

    </div>
  </div>
</section>

<style>
  .faq-item.active .faq-icon {
    @apply bg-primary/10;
  }
  .faq-item.active .faq-icon svg {
    transform: rotate(180deg);
  }
  .faq-item.active {
    @apply border-primary/20;
  }
</style>

<script>
  document.querySelectorAll('.faq-item button').forEach((button) => {
    button.addEventListener('click', () => {
      const item = button.closest('.faq-item');
      const answer = item?.querySelector('.faq-answer') as HTMLElement;
      const isActive = item?.classList.contains('active');

      // Close all
      document.querySelectorAll('.faq-item').forEach((faq) => {
        faq.classList.remove('active');
        const ans = faq.querySelector('.faq-answer') as HTMLElement;
        if (ans) ans.style.maxHeight = '0';
        faq.querySelector('button')?.setAttribute('aria-expanded', 'false');
      });

      // Open clicked
      if (!isActive && answer) {
        item?.classList.add('active');
        answer.style.maxHeight = answer.scrollHeight + 'px';
        button.setAttribute('aria-expanded', 'true');
      }
    });
  });
</script>
